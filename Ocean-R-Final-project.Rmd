---
title: "A Study on Flocking behavior and Sexual Dimorphism in Taiwanese Birds"
author: "Ming-Pei Li 61143008S, Wei-Ting Sun 61343013S"
date: "2024-12-01"
output:
  pagedown::html_paged:
    number_sections: true   # 是否為每一節編號
fontsize: 12pt             # 設定字體大小
mainfont: "Times New Roman" # 設定字型
latex_engine: xelatex
---
\newpage

## Introduction

### Topic 1: Flocking behavior

Flocking behavior in birds plays a critical role in their survival, as studies have demonstrated that birds in obligate flocks exhibit higher survival rates compared to solitary foragers, supporting the adaptive value of flocking (Jullien & Clobert, 2000). Avian flocking behavior is influenced by multiple factors, primarily predation avoidance and foraging efficiency (Jaime & Zuluaga, 2013). In high predation risk areas, birds tend to form larger, more compact flocks and exhibit increased vigilance behaviors (Barbosa, 1997). This connection between predation and flocking is further supported by the reduced tendency to flock and smaller flock sizes observed in bird species inhabiting islands with relaxed predation pressure (Beauchamp, 2004). However, the persistence of flocking in some island species indicates that other factors, such as foraging benefits, also contribute to maintaining flocking behavior (Beauchamp, 2004; Jaime & Zuluaga, 2013). As human development continues to alter natural landscapes, changes in bird flocking behavior may occur.
For instance, habitat fragmentation in Amazonian rainforests negatively affects flock interaction networks, leading to a decline in association frequencies and reduced flock cohesion in disturbed areas (Mokross et al., 2014). Similarly, urban environments, characterized by lower predation risk, are associated with smaller and less compact flocks compared to rural counterparts (Carere et al., 2009). Additionally, urban habitats provide reliable food sources, resulting in more consistent foraging patterns and social networks among urban birds (Jones et al., 2019).
Building on these findings, we hypothesize that bird flocking behavior differs between anthropogenic and natural habitats due to variations in predation risk and food resource availability. Specifically, anthropogenic habitats, with their lower predation risk and consistent food supply, are likely to support less flocking behavior among birds compared to natural habitats. To study this question, we analyze data from bird populations in Taiwan to investigate differences in flocking behavior across anthropogenic and natural habitats. 

### Topic 2: Sexual Dimorphism

Research on plumage dimorphism in birds reveals complex relationships with activity patterns and environmental factors. Studies have shown that different forms of dimorphism are associated with various aspects of avian behavior and ecology. Plumage-color dimorphism is linked to extra-pair paternity rates (Owens & Hartley, 1998). Nest predation may constrain female plumage brightness more than male plumage, particularly in species where only females incubate (Martin & Badyaev, 1996). Social mating systems strongly influence multiple forms of dimorphism, with polygynous and lekking species showing greater dimorphism than monogamous ones (Dunn et al., 2001).
Color polymorphism in birds, occurring in 3.5% of species, is most prevalent in certain orders and may be maintained by disruptive selection related to detectability under variable light conditions (Galeotti et al., 2003). Activity patterns significantly influence eye morphology in birds, with nocturnal species having larger corneal diameters relative to axial lengths for enhanced visual sensitivity, while diurnal birds have larger axial lengths for improved visual acuity (Hall & Ross, 2007). 
However, the relationship between avian activity time and plumage dimorphism has yet to be thoroughly investigated. Therefore, this study aims to examine whether there is a significant association between the activity time of birds and their plumage dimorphism.

\newpage
## Methods

#### Steps for R code

Load the necessary packages.
```{r, warning = FALSE, message = FALSE}
library (dplyr)
library (ggplot2)
library (tidyr)
library (mvabund)
```

```{r, warning = FALSE, message = FALSE}
bird_2 <- read.table ("dwca-trait_454-v1.68/measurementorfacts.txt", header = TRUE, sep = "\t", fill = TRUE)

bird_3 <-  read.table ("dwca-trait_454-v1.68/taxon.txt", header = TRUE, sep = "\t", quote = "", fill = TRUE)
```

\newpage
*Hypothesis 1: Birds exhibit less flocking behavior  in anthropogenic habitats compared to natural habitats, due to reduced predation risk and more stable food resource availability in anthropogenic environments.*

Filter the bird data for conspecific flocking behavior during the non-breeding season.
```{r, warning = FALSE, message = FALSE}
co_flocks_nbd <- bird_2 %>% 
  filter (measurementType %in% c("Flocks_ConspecificsNonBreedingSeason"))
```

Filter the bird data for non-territorial birds during the non-breeding season.
```{r, warning = FALSE, message = FALSE}
nt_nbs <- bird_2 %>% 
  filter (measurementType == "Territoriality_NonBreedingSeason" & measurementValue == 0)
```

Birds living in anthropogenic habitats, such as dryland farming and urban parks, are classified as 'Anthropogenic habitat.' Birds not living in these anthropogenic habitats are classified as 'Natural habitat.'
```{r, warning = FALSE, message = FALSE}
human_habitat <- bird_2 %>% 
  filter (measurementType %in% 
            c("Habitat_DrylandFarming",
              "Habitat_UrbanParks",
              "Habitat_UrbanRuralArea",
              "Habitat_AquaculturePonds",
              "Habitat_SaltExploitationSites",
              "Habitat_PaddyField") & 
            measurementValue == 1) %>% 
  mutate (habitat = "Anthropogenic habitat")

nonhuman_habitat <- bird_2 %>% 
  filter (grepl ("Habitat", measurementType) 
          & !(measurementType %in% c("Habitat_DrylandFarming",
                                     "Habitat_UrbanParks",                                 
                                     "Habitat_UrbanRuralArea", 
                                     "Habitat_AquaculturePonds", 
                                     "Habitat_SaltExploitationSites",
                                     "Habitat_PaddyField")) & 
            measurementValue == 1) %>% 
  mutate (habitat = "Natural habitat")
```


Combine all habitat data and determine the primary habitat (either natural or anthropogenic) for each bird.
```{r, warning = FALSE, message = FALSE}
maj_habitat <- 
  rbind (nonhuman_habitat, human_habitat) %>% 
  group_by (id, habitat) %>%
  tally () %>% 
  group_by (id) %>%
  filter (n == max (n) & n != min(n)) %>%
  select (id, majority_habitat = habitat)
```

Merge the flocking behavior data with the primary habitat data and filter for non-territorial birds during the non-breeding season. We focus on non-territorial birds during this period because we believe that territorial birds, such as eagles, do not exhibit flocking behavior during the non-breeding season. Therefore, we choose non-territorial birds for analysis.
```{r, warning = FALSE, message = FALSE}
co_flock_habitat <- co_flocks_nbd %>%
  inner_join (maj_habitat, by = "id") %>% 
  inner_join(bird_3, by = "id") %>% 
  filter (id %in% nt_nbs$id)
```
Categorical data can be analyzed using the Chi-square test, Fisher's exact test, and Generalized Linear Model. We need to confirm whether the assumptions of each test are met by the bird data.

The assumptions for the Chi-square test and Fisher's exact test are as follows:
1. Both variables are categorical.
2. Observations are independent.
3. Cells in the contingency table are mutually exclusive.
4. The expected value in at least 80% of the cells should be 5 or greater. If any expected value is less than 5, Fisher's exact test should be used instead.
\newpage
The bird data currently satisfies the first three assumptions. Therefore, we calculate whether the expected value in at least 80% of the cells is greater than or less than 5 to decide whether to use the Chi-square test or Fisher's exact test.

Create a contingency table
```{r, warning = FALSE, message = FALSE}
flock_table <- matrix(
  c(sum (co_flock_habitat$majority_habitat == "Natural habitat" & co_flock_habitat$measurementValue == 1), 
    sum (co_flock_habitat$majority_habitat == "Anthropogenic habitat" & co_flock_habitat$measurementValue == 1), 
    sum (co_flock_habitat$majority_habitat == "Natural habitat" & co_flock_habitat$measurementValue == 0),
    sum (co_flock_habitat$majority_habitat == "Anthropogenic habitat" & co_flock_habitat$measurementValue == 0)), 
  nrow = 2, 
  byrow = TRUE)

rownames (flock_table) <- c("Natural habitat", "Anthropogenic habitat")
colnames (flock_table) <- c("Yes (1)", "No (0)")
```
\newpage
Print the contingency table
```{r, warning = FALSE, message = FALSE}
print (flock_table)
```

Perform the Chi-squared test and obtain expected values
```{r, warning = FALSE}
chi_result <- chisq.test (flock_table)
print (chi_result$expected)
```
All expected values for the bird data cells are greater than five. The counts are as follows: 119 for flocking in natural habitats, 12 for no flocking in natural habitats, 69 for flocking in anthropogenic habitats, and 7 for no flocking in anthropogenic habitats. Therefore, we use the Chi-squared test to analyze whether bird flocking behavior significantly differs between natural and anthropogenic habitats.

Use the Chi-squared test to whether bird flocking behavior significantly differs between natural and anthropogenic habitats.
```{r}
chisq.test (co_flock_habitat$measurementValue, co_flock_habitat$majority_habitat)
```

The assumptions for the Generalized Linear Model (GLM) are as follows:
1. The observed values of y are independent, conditional on some predictors x.
2. The response y follows a known distribution with a known mean-variance relationship.
3. There is a linear relationship between a known function g of the mean y and the predictor x.

The bird data fits the first assumption. To check the second assumption, we examined a plot of the residuals and observed a fan shape in the bird data. Therefore, we decided not to use GLM to analyze the bird data.
```{r, warning = FALSE, message = FALSE}
bird.many <- manyglm (measurementValue ~ majority_habitat, family = "binomial", data = co_flock_habitat)
plot (bird.many)
```

Calculate the proportion of birds exhibiting flocking behavior in different habitats.
```{r, warning = FALSE, message = FALSE}
stacked_data <- co_flock_habitat %>%
  group_by (majority_habitat, measurementValue) %>%
  summarise (count = n ()) %>%
  ungroup () %>% 
  group_by (majority_habitat) %>%
  mutate (percentage = count / sum (count))
```

Plot the proportion of birds exhibiting flocking behavior by habitat type using a stacked bar chart.
```{r, warning = FALSE, message = FALSE}
ggplot(stacked_data, aes(x = majority_habitat, y = percentage, fill = as.factor (measurementValue))) +
  geom_bar(stat = "identity", position = "stack", width = 0.6) +
  scale_fill_manual(values = c("1" = "skyblue", "0" = "lightcoral"),
                    labels = c("1 (Flocking)", "0 (No Flocking)"),
                    name = "Flocking Behavior") +
  labs(title = "Flocking Behavior by Habitat",
       x = "Habitat Type",
       y = "Proportion") +
  scale_y_continuous (limits = c(0, 1.1), breaks = seq (0, 1, 0.2), labels = c("0.00", "0.20", "0.40", "0.60", "0.80", "1.00")) +
  theme_minimal() +
  theme (legend.position = "top",
         panel.grid.minor.y = element_blank (),
         panel.grid.major.x = element_blank (),
         plot.title = element_text (hjust = 0.5, size = 16),
         plot.margin = margin (20, 20, 20, 20),
         axis.title.x = element_text (margin = margin(t = 15), size = 12),
         axis.title.y = element_text (margin = margin(r = 10), size = 12),
         axis.text.x = element_text (size = 12),
         axis.text.y = element_text (size = 12)) +
  annotate ("text", x = 1.5, y = 1.1, label = "*", size = 6, color = "black") +
  annotate ("segment", x = 1, xend = 2, y = 1.05, yend = 1.05, color = "black", linewidth = 0.5) +
  annotate ("text", x = 2, y = 0.1, label = "n = 189", size = 4, color = "black") +
  annotate ("text", x = 1, y = 0.1, label = "n = 20", size = 4, color = "black")
```

Figure 1. The Impact of Habitat on Bird Flocking Behavior
This figure presents the proportion of birds exhibiting flocking behavior during the non-breeding season across different habitats, classified as either anthropogenic habitat (e.g.,  dryland farming, urban parks) or natural habitat. The data are shown as a stacked bar plot, where the colors of the bars represent whether flocking behavior was observed (red for flocking, blue for no flocking). The sample sizes for each habitat are indicated at the bottom, with 20 birds in anthropogenic habitats and 189 birds in natural habitats. Asterisks above the bars indicate a statistically significant difference.

*Hypothesis 2: There is more plumage dimorphism in diurnal versus nocturnal birds.*

```{r, warning = FALSE, message = FALSE}


Dimorphism_ActivityTime <- subset(bird_2, grepl("Dimorphism|ActivityTime", measurementType))
# grepl 的使用在這裡是因為需要進行 部分文字匹配，而不是直接篩選一個完整的值。

Dimorphism_ActivityTime_1 <- Dimorphism_ActivityTime %>% separate(col = "measurementType", 
                              sep = "_", 
                              into = c("measurement", "Type"))

Dimorphism <- Dimorphism_ActivityTime_1 %>% filter(measurement=="Dimorphism" & Type=="Plumage") 
Dimorphism_1 <- Dimorphism %>% select(-measurement, -Type) %>% rename("Plumage"=measurementValue)

ActivityTime <- Dimorphism_ActivityTime_1 %>% filter(measurement=="ActivityTime" & measurementValue==1)
ActivityTime_1 <- ActivityTime %>% select(id, Type)

bird_dim_act <- merge(Dimorphism_1, ActivityTime_1, by = "id")
```

Use the Fisher's Exact Test to compare whether birds with different active times (diurnal vs. nocturnal birds) show significant differences in plumage dimorphism.

```{r, warning = FALSE, message = FALSE}

chisq.test (bird_dim_act$Type, bird_dim_act$Plumage) # p-value = 0.7822
```

Use the Chi-squared test to compare whether birds with different active times (diurnal vs. nocturnal birds) show significant differences in plumage dimorphism, applicable for small sample sizes.

```{r, warning = FALSE, message = FALSE}
fisher.test (bird_dim_act$Type, bird_dim_act$Plumage) # p-value = 0.7295

logistic <- glm(Plumage~Type, data = bird_dim_act, family = binomial)
summary(logistic)

data_summary <- bird_dim_act %>%
  group_by(Type) %>%
  summarise(Count = n(), Plumage_Proportion = mean(Plumage == 1))
# Diurnal = 0.3167421, Nocturnal = 0.3364486

ggplot(bird_dim_act, aes(x = Type, fill = as.factor(Plumage))) +
  geom_bar(position = "fill", width = 0.6) +
  labs(
    title = "Plumage Dimorphism",
    x = "Activity Time",
    y = "Proportion",
    fill = "Plumage\nDimorphism"
  ) +
  scale_fill_manual(values = c("1" = "skyblue", "0" = "lightcoral"),labels = c("0" = "No", "1" = "Yes"))+ 
  scale_y_continuous(labels = scales::percent_format()) +
  theme_minimal()+
  annotate ("text", x = 2, y = 0.1, label = "n = 107", size = 4, color = "dimgray") +
  annotate ("text", x = 1, y = 0.1, label = "n = 442", size = 4, color = "dimgray")
```

Figure 2. Percentage of plumage colour dimorphism in birds with different activity times

## Results
Figure 1 illustrates a significant difference in flocking behavior between Taiwanese birds from different habitats, with a higher proportion of birds exhibiting flocking behavior in natural habitats compared to anthropogenic habitats. The Chi-squared test revealed a significant difference in flocking behavior between the two habitats (χ² = 5.63, df = 1, p = 0.017). This finding indicates that birds in natural habitats are significantly more likely to exhibit flocking behavior than those in anthropogenic habitats.

## Discussion

The results indicate that Taiwanese birds in natural habitats have a significantly higher probability of exhibiting flocking behavior compared to those in anthropogenic habitats. This difference may be primarily due to predation avoidance and foraging efficiency. In natural habitats, flocking behavior likely provides an advantage by reducing the risk of predation and improving foraging success. In contrast, anthropogenic habitats may serve as refuges for prey species due to lower predation pressures. Studies have shown a decline in nest predation from natural to urban sites (Gering & Blair, 1999), suggesting that urban environments present a lower predation risk for birds.

Moreover, urban environments provide a stable food supply and reduced predation risk, which contribute to higher bird population densities, even though per capita food availability may be low. The presence of food sources, such as restaurants, has been shown to influence avian communities, potentially leading to a decrease in species diversity while increasing the abundance of species that exploit urban resources (Brown et al., 2022). This shift in the food resource landscape may further impact bird behavior, including flocking patterns.

However, the abundance of anthropogenic food sources can also disrupt predator-prey relationships in urban environments. Predators may shift their focus to human-provided resources, decoupling the natural predator-prey dynamics that govern behaviors in more natural habitats (Rodewald et al., 2011). This change in resource availability can have cascading effects on bird behavior, including the likelihood of flocking, as birds adapt to the altered ecological conditions of urban habitats.

\newpage
## References
Barbosa, A. (1997). The effects of predation risk on scanning and flocking behavior in dunlin. https://digital.csic.es/handle/10261/9360

Beauchamp, G. (2004). Reduced Flocking by Birds on Islands with Relaxed Predation. Proceedings: Biological Sciences, 271(1543), 1039–1042.

Brown, J. A., Lerman, S. B., Basile, A. J., Bateman, H. L., Deviche, P., Warren, P. S., & Sweazea, K. L. (2022). No fry zones: How restaurant distribution and abundance influence avian communities in the Phoenix, AZ metropolitan area. PLOS ONE, 17(10), e0269334. https://doi.org/10.1371/journal.pone.0269334

Carere, C., Montanino, S., Moreschini, F., Zoratto, F., Chiarotti, F., Santucci, D., & Alleva, E. (2009). Aerial flocking patterns of wintering starlings, Sturnus vulgaris, under different predation risk. Animal Behaviour, 77(1), 101–107. https://doi.org/10.1016/j.anbehav.2008.08.034

Dunn, P. O., Whittingham, L. A., & Pitcher, T. E. (2001). MATING SYSTEMS, SPERM COMPETITION, AND THE EVOLUTION OF SEXUAL DIMORPHISM IN BIRDS. Evolution, 55(1), 161–175. https://doi.org/10.1111/j.0014-3820.2001.tb01281.x

Galeotti, P., Rubolini, D., Dunn, P. O., & Fasola, M. (2003). Colour polymorphism in birds: Causes and functions. Journal of Evolutionary Biology, 16(4), 635–646. https://doi.org/10.1046/j.1420-9101.2003.00569.x

Gering, J.C. and Blair, R.B. (1999), Predation on artificial bird nests along an urban gradient: predatory risk or relaxation in urban environments?. Ecography, 22: 532-541. https://doi.org/10.1111/j.1600-0587.1999.tb01283.x

Hall, M. I., & Ross, C. F. (2007). Eye shape and activity pattern in birds. Journal of Zoology, 271(4), 437–444. https://doi.org/10.1111/j.1469-7998.2006.00227.x

Jaime, G., & Zuluaga, C.J. (2013). WHY ANIMALS COME TOGETHER, WITH THE SPECIAL CASE OF MIXED-SPECIES BIRD FLOCKS.

Jones, T. B., Evans, J. C., & Morand-Ferron, J. (2019). Urbanization and the temporal patterns of social networks and group foraging behaviors. Ecology and Evolution, 9(8), 4589–4602. https://doi.org/10.1002/ece3.5060

Jullien, M., & Clobert, J. (2000). The Survival Value of Flocking in Neotropical Birds: Reality or Fiction? Ecology, 81(12), 3416–3430. https://doi.org/10.1890/0012-9658(2000)081[3416:TSVOFI]2.0.CO;2

Martin, T. E., & Badyaev, A. V. (1996). SEXUAL DICHROMATISM IN BIRDS: IMPORTANCE OF NEST PREDATION AND NEST LOCATION FOR FEMALES VERSUS MALES. Evolution, 50(6), 2454–2460. https://doi.org/10.1111/j.1558-5646.1996.tb03631.x

Mokross, K., Ryder, T. B., Côrtes, M. C., Wolfe, J. D., & Stouffer, P. C. (2014). Decay of interspecific avian flock networks along a disturbance gradient in Amazonia. Proceedings of the Royal Society B: Biological Sciences, 281(1776), 20132599. https://doi.org/10.1098/rspb.2013.2599

Owens, I. P. F., & Hartley, I. R. (1998). Sexual dimorphism in birds: Why are there so many different forms of dimorphism? Proceedings of the Royal Society of London. Series B: Biological Sciences, 265(1394), 397–407. https://doi.org/10.1098/rspb.1998.0308

Rodewald, A. D., Kearns, L. J., & Shustack, D. P. (2011). Anthropogenic resource subsidies decouple predator-prey relationships. Ecological Applications: A Publication of the Ecological Society of America, 21(3), 936–943. https://doi.org/10.1890/10-0863.1
