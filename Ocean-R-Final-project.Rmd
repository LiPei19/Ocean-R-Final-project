---
title: "A Study on Flocking behavior and Sexual Dimorphism in Taiwanese Birds"
author: "Ming-Pei Li 61143008S, Wei-Ting Sun 61343013S"
date: "2024-12-01"
output: html_document
---

## Introduction

### Topic 1: Flocking behavior

Flocking behavior in birds plays a critical role in their survival, as studies have demonstrated that birds in obligate flocks exhibit higher survival rates compared to solitary foragers, supporting the adaptive value of flocking (Jullien & Clobert, 2000). Avian flocking behavior is influenced by multiple factors, primarily predation avoidance and foraging efficiency (Jaime & Zuluaga, 2013). In high predation risk areas, birds tend to form larger, more compact flocks and exhibit increased vigilance behaviors (Barbosa, 1997). This connection between predation and flocking is further supported by the reduced tendency to flock and smaller flock sizes observed in bird species inhabiting islands with relaxed predation pressure (Beauchamp, 2004). However, the persistence of flocking in some island species indicates that other factors, such as foraging benefits, also contribute to maintaining flocking behavior (Beauchamp, 2004; Jaime & Zuluaga, 2013). As human development continues to alter natural landscapes, changes in bird flocking behavior may occur.

For instance, habitat fragmentation in Amazonian rainforests negatively affects flock interaction networks, leading to a decline in association frequencies and reduced flock cohesion in disturbed areas (Mokross et al., 2014). Similarly, urban environments, characterized by lower predation risk, are associated with smaller and less compact flocks compared to rural counterparts (Carere et al., 2009). Additionally, urban habitats provide reliable food sources, resulting in more consistent foraging patterns and social networks among urban birds (Jones et al., 2019).

Building on these findings, we hypothesize that bird flocking behavior differs between anthropogenic and natural habitats due to variations in predation risk and food resource availability. Specifically, anthropogenic habitats, with their lower predation risk and consistent food supply, are likely to support less flocking behavior among birds compared to natural habitats. To study this question, we analyze data from bird populations in Taiwan to investigate differences in flocking behavior across anthropogenic and natural habitats. 

### Topic 2: Sexual Dimorphism

Research on plumage dimorphism in birds reveals complex relationships with activity patterns and environmental factors. Studies have shown that different forms of dimorphism are associated with various aspects of avian behavior and ecology. Plumage-color dimorphism is linked to extra-pair paternity rates (Owens & Hartley, 1998). Nest predation may constrain female plumage brightness more than male plumage, particularly in species where only females incubate (Martin & Badyaev, 1996). Social mating systems strongly influence multiple forms of dimorphism, with polygynous and lekking species showing greater dimorphism than monogamous ones (Dunn et al., 2001).

Color polymorphism in birds, occurring in 3.5% of species, is most prevalent in certain orders and may be maintained by disruptive selection related to detectability under variable light conditions (Galeotti et al., 2003). Activity patterns significantly influence eye morphology in birds, with nocturnal species having larger corneal diameters relative to axial lengths for enhanced visual sensitivity, while diurnal birds have larger axial lengths for improved visual acuity (Hall & Ross, 2007). 

However, the relationship between avian activity time and plumage dimorphism has yet to be thoroughly investigated. Therefore, this study aims to examine whether there is a significant association between the activity time of birds and their plumage dimorphism.

## Methods

#### Steps for R code

Load the necessary packages.
```{r, warning = FALSE, message = FALSE}
library (dplyr)
library (ggplot2)
library (tidyr)
```

```{r, warning = FALSE, message = FALSE}
bird_2 <- read.table ("dwca-trait_454-v1.68/measurementorfacts.txt", header = TRUE, sep = "\t", fill = TRUE)

bird_3 <-  read.table ("dwca-trait_454-v1.68/taxon.txt", header = TRUE, sep = "\t", quote = "", fill = TRUE)
```

*Hypothesis 1:*

Filter the bird data for conspecific flocking behavior during the non-breeding season.
```{r, warning = FALSE, message = FALSE}
co_flocks_nbd <- bird_2 %>% 
  filter (measurementType %in% c("Flocks_ConspecificsNonBreedingSeason"))
```

Filter the bird data for non-territorial birds during the non-breeding season.
```{r, warning = FALSE, message = FALSE}
nt_nbs <- bird_2 %>% 
  filter (measurementType == "Territoriality_NonBreedingSeason" & measurementValue == 0)
```

Classify birds living in anthropogenic habitats (such as farmlands, urban parks, etc.) as "Anthropogenic habitat." Classify birds not living in these anthropogenic habitats as "Natural habitat."
```{r, warning = FALSE, message = FALSE}
human_habitat <- bird_2 %>% 
  filter (measurementType %in% 
            c("Habitat_DrylandFarming",
              "Habitat_UrbanParks",
              "Habitat_UrbanRuralArea",
              "Habitat_AquaculturePonds",
              "Habitat_SaltExploitationSites",
              "Habitat_PaddyField") & 
            measurementValue == 1) %>% 
  mutate (habitat = "Anthropogenic habitat")

nonhuman_habitat <- bird_2 %>% 
  filter (grepl ("Habitat", measurementType) 
          & !(measurementType %in% c("Habitat_DrylandFarming",
                                     "Habitat_UrbanParks",                                 
                                     "Habitat_UrbanRuralArea", 
                                     "Habitat_AquaculturePonds", 
                                     "Habitat_SaltExploitationSites",
                                     "Habitat_PaddyField")) & 
            measurementValue == 1) %>% 
  mutate (habitat = "Natural habitat")
```


Combine all habitat data and determine the primary habitat (either natural or anthropogenic) for each bird.
```{r, warning = FALSE, message = FALSE}
maj_habitat <- 
  rbind (nonhuman_habitat, human_habitat) %>% 
  group_by (id, habitat) %>%
  tally () %>% 
  group_by (id) %>%
  filter (n == max (n) & n != min(n)) %>%
  select (id, majority_habitat = habitat)
```

Merge the flocking behavior data with the primary habitat data and filter for non-territorial birds during the non-breeding season.
```{r, warning = FALSE, message = FALSE}
co_flock_habitat <- co_flocks_nbd %>%
  inner_join (maj_habitat, by = "id") %>% 
  inner_join(bird_3, by = "id") %>% 
  filter (id %in% nt_nbs$id)
```

Use the Chi-squared test to compare whether birds from different habitats (natural vs. anthropogenic) show significant differences in flocking behavior.
```{r, warning = FALSE, message = FALSE}
chisq.test (co_flock_habitat$measurementValue, co_flock_habitat$majority_habitat)
```

Use Fisher's Exact Test to compare whether birds from different habitats (natural vs. anthropogenic) show significant differences in flocking behavior, applicable for small sample sizes.
```{r, warning = FALSE, message = FALSE}
fisher.test (co_flock_habitat$measurementValue, co_flock_habitat$majority_habitat)
```

Use a Generalized Linear Model (GLM) with bird flocking behavior (yes/no) as the dependent variable and primary habitat (natural or anthropogenic) as the independent variable to further examine the impact of habitat on flocking behavior.
```{r, warning = FALSE, message = FALSE}
bird_glm <- glm (measurementValue ~ majority_habitat,
                 data = co_flock_habitat, 
                 family = binomial)
summary (bird_glm)
```

Calculate the frequency of combinations between different habitats and whether flocking behavior (yes/no) is present.
```{r, warning = FALSE, message = FALSE}
stacked_data <- co_flock_habitat %>%
  group_by (majority_habitat, measurementValue) %>%
  summarise (count = n ()) %>%
  ungroup ()
```

Calculate the proportion of birds exhibiting flocking behavior in different habitats.
```{r, warning = FALSE, message = FALSE}
stacked_data <- stacked_data %>%
  group_by (majority_habitat) %>%
  mutate (percentage = count / sum (count))
```

Plot the proportion of birds exhibiting flocking behavior by habitat type using a stacked bar chart.
```{r, warning = FALSE, message = FALSE}
ggplot(stacked_data, aes(x = majority_habitat, y = percentage, fill = as.factor (measurementValue))) +
  geom_bar(stat = "identity", position = "stack", width = 0.6) +
  scale_fill_manual(values = c("1" = "skyblue", "0" = "lightcoral"),
                    labels = c("1 (Flocking)", "0 (No Flocking)"),
                    name = "Flocking Behavior") +
  labs(title = "Flocking Behavior by Habitat",
       x = "Habitat Type",
       y = "Proportion") +
  scale_y_continuous (limits = c(0, 1.1), breaks = seq (0, 1, 0.2), labels = c("0.00", "0.20", "0.40", "0.60", "0.80", "1.00")) +
  theme_minimal() +
  theme (legend.position = "top",
         panel.grid.minor.y = element_blank (),
         panel.grid.major.x = element_blank (),
         plot.title = element_text (hjust = 0.5, size = 16),
         plot.margin = margin (20, 20, 20, 20),
         axis.title.x = element_text (margin = margin(t = 15), size = 12),
         axis.title.y = element_text (margin = margin(r = 10), size = 12),
         axis.text.x = element_text (size = 12),
         axis.text.y = element_text (size = 12)) +
  annotate ("text", x = 1.5, y = 1.1, label = "*", size = 6, color = "black") +
  annotate ("segment", x = 1, xend = 2, y = 1.05, yend = 1.05, color = "black", linewidth = 0.5) +
  annotate ("text", x = 2, y = 0.1, label = "n = 189", size = 4, color = "black") +
  annotate ("text", x = 1, y = 0.1, label = "n = 20", size = 4, color = "black")
```

Figure 1. The Impact of Habitat on Bird Flocking Behavior
This figure presents the proportion of birds exhibiting flocking behavior during the non-breeding season across different habitats, classified as either anthropogenic habitat (e.g., farmland, urban parks) or natural habitat. The data are shown as a stacked bar plot, where the colors of the bars represent whether flocking behavior was observed (red for flocking, blue for no flocking). The sample sizes for each habitat are indicated at the bottom, with 20 birds in anthropogenic habitats and 189 birds in natural habitats. Asterisks above the bars indicate a statistically significant difference.

*Hypothesis 2: There is more plumage dimorphism in diurnal versus nocturnal birds.*

```{r, warning = FALSE, message = FALSE}


Dimorphism_ActivityTime <- subset(bird_2, grepl("Dimorphism|ActivityTime", measurementType))
# grepl 的使用在這裡是因為需要進行 部分文字匹配，而不是直接篩選一個完整的值。

Dimorphism_ActivityTime_1 <- Dimorphism_ActivityTime %>% separate(col = "measurementType", 
                              sep = "_", 
                              into = c("measurement", "Type"))

Dimorphism <- Dimorphism_ActivityTime_1 %>% filter(measurement=="Dimorphism" & Type=="Plumage") 
Dimorphism_1 <- Dimorphism %>% select(-measurement, -Type) %>% rename("Plumage"=measurementValue)

ActivityTime <- Dimorphism_ActivityTime_1 %>% filter(measurement=="ActivityTime" & measurementValue==1)
ActivityTime_1 <- ActivityTime %>% select(id, Type)

bird_dim_act <- merge(Dimorphism_1, ActivityTime_1, by = "id")
```

Use the Fisher's Exact Test to compare whether birds with different active times (diurnal vs. nocturnal birds) show significant differences in plumage dimorphism.

```{r, warning = FALSE, message = FALSE}

chisq.test (bird_dim_act$Type, bird_dim_act$Plumage) # p-value = 0.7822
```

Use the Chi-squared test to compare whether birds with different active times (diurnal vs. nocturnal birds) show significant differences in plumage dimorphism, applicable for small sample sizes.

```{r, warning = FALSE, message = FALSE}
fisher.test (bird_dim_act$Type, bird_dim_act$Plumage) # p-value = 0.7295

logistic <- glm(Plumage~Type, data = bird_dim_act, family = binomial)
summary(logistic)

data_summary <- bird_dim_act %>%
  group_by(Type) %>%
  summarise(Count = n(), Plumage_Proportion = mean(Plumage == 1))
# Diurnal = 0.3167421, Nocturnal = 0.3364486

ggplot(bird_dim_act, aes(x = Type, fill = as.factor(Plumage))) +
  geom_bar(position = "fill", width = 0.6) +
  labs(
    title = "Plumage Dimorphism",
    x = "Activity Time",
    y = "Proportion",
    fill = "Plumage\nDimorphism"
  ) +
  scale_fill_manual(values = c("1" = "skyblue", "0" = "lightcoral"),labels = c("0" = "No", "1" = "Yes"))+ 
  scale_y_continuous(labels = scales::percent_format()) +
  theme_minimal()+
  annotate ("text", x = 2, y = 0.1, label = "n = 107", size = 4, color = "dimgray") +
  annotate ("text", x = 1, y = 0.1, label = "n = 442", size = 4, color = "dimgray")
```

Figure 2. Percentage of plumage colour dimorphism in birds with different activity times

## Results
Figure 1 shows a significant difference in flocking behavior between birds from different habitats, with a higher proportion of birds exhibiting flocking behavior in natural habitats compared to anthropogenic habitats. The Chi-squared test revealed a significant difference in flocking behavior between habitats (χ² = 5.63, df = 1, p = 0.017). Additionally, Fisher's Exact Test confirmed this result, showing a significant difference in flocking behavior between habitats (p = 0.007, 95% CI: 0.0186–0.743). The Generalized Linear Model (GLM) analysis further supported this finding, indicating that birds in natural habitats have a significantly higher probability of flocking behavior compared to those in anthropogenic habitats (estimate = -1.78, p = 0.019).

## Disscussion


## References
Barbosa, A. (1997). The effects of predation risk on scanning and flocking behavior in dunlin. https://digital.csic.es/handle/10261/9360

Beauchamp, G. (2004). Reduced Flocking by Birds on Islands with Relaxed Predation. Proceedings: Biological Sciences, 271(1543), 1039–1042.

Carere, C., Montanino, S., Moreschini, F., Zoratto, F., Chiarotti, F., Santucci, D., & Alleva, E. (2009). Aerial flocking patterns of wintering starlings, Sturnus vulgaris, under different predation risk. Animal Behaviour, 77(1), 101–107. https://doi.org/10.1016/j.anbehav.2008.08.034

Dunn, P. O., Whittingham, L. A., & Pitcher, T. E. (2001). MATING SYSTEMS, SPERM COMPETITION, AND THE EVOLUTION OF SEXUAL DIMORPHISM IN BIRDS. Evolution, 55(1), 161–175. https://doi.org/10.1111/j.0014-3820.2001.tb01281.x

Galeotti, P., Rubolini, D., Dunn, P. O., & Fasola, M. (2003). Colour polymorphism in birds: Causes and functions. Journal of Evolutionary Biology, 16(4), 635–646. https://doi.org/10.1046/j.1420-9101.2003.00569.x

Hall, M. I., & Ross, C. F. (2007). Eye shape and activity pattern in birds. Journal of Zoology, 271(4), 437–444. https://doi.org/10.1111/j.1469-7998.2006.00227.x

Jaime, G., & Zuluaga, C.J. (2013). WHY ANIMALS COME TOGETHER, WITH THE SPECIAL CASE OF MIXED-SPECIES BIRD FLOCKS.

Jones, T. B., Evans, J. C., & Morand-Ferron, J. (2019). Urbanization and the temporal patterns of social networks and group foraging behaviors. Ecology and Evolution, 9(8), 4589–4602. https://doi.org/10.1002/ece3.5060

Jullien, M., & Clobert, J. (2000). The Survival Value of Flocking in Neotropical Birds: Reality or Fiction? Ecology, 81(12), 3416–3430. https://doi.org/10.1890/0012-9658(2000)081[3416:TSVOFI]2.0.CO;2

Martin, T. E., & Badyaev, A. V. (1996). SEXUAL DICHROMATISM IN BIRDS: IMPORTANCE OF NEST PREDATION AND NEST LOCATION FOR FEMALES VERSUS MALES. Evolution, 50(6), 2454–2460. https://doi.org/10.1111/j.1558-5646.1996.tb03631.x

Mokross, K., Ryder, T. B., Côrtes, M. C., Wolfe, J. D., & Stouffer, P. C. (2014). Decay of interspecific avian flock networks along a disturbance gradient in Amazonia. Proceedings of the Royal Society B: Biological Sciences, 281(1776), 20132599. https://doi.org/10.1098/rspb.2013.2599

Owens, I. P. F., & Hartley, I. R. (1998). Sexual dimorphism in birds: Why are there so many different forms of dimorphism? Proceedings of the Royal Society of London. Series B: Biological Sciences, 265(1394), 397–407. https://doi.org/10.1098/rspb.1998.0308
